"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([[66755],{12078:(e,t,n)=>{var a=n(24994);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=a(n(94634)),l=a(n(43693)),r=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=v(t);if(n&&n.has(e))return n.get(e);var a={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in e)if("default"!==l&&{}.hasOwnProperty.call(e,l)){var r=o?Object.getOwnPropertyDescriptor(e,l):null;r&&(r.get||r.set)?Object.defineProperty(a,l,r):a[l]=e[l]}return a.default=e,n&&n.set(e,a),a}(n(96540)),i=n(5556),s=a(n(97945)),c=n(15637),u=a(n(76047)),d=a(n(71067)),p=a(n(38101)),g=a(n(60104)),m=a(n(34921)),f=a(n(25390)),C=n(25350),b=n(54658),_=n(49054),E=n(70655),O=n(39673);function v(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(v=function(e){return e?n:t})(e)}function I(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function w(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?I(Object(n),!0).forEach((function(t){(0,l.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):I(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const A={api:"",message:"",inputFieldError:!1,bottomSheetError:!1,statusCode:200},k=e=>{let{allowDirectLogin:t,country:n,mobile:a="",email:l="",source:i="",appCode:v="",vh:I=0,recoverToken:k,isDesktop:y=!1,userDetail:S={},isPinkified:P=!0,otpDetailsFromVerifyScreen:D={},tempUd:h={},onCloseClick:T=()=>null,verificationType:N="login",onOTPVerifiedSuccess:R=()=>null,resendOtpClickCSCallback:L=()=>null,resendOtpClickGACallback:G=()=>null,submitOtpClickCSCallback:M=()=>null,submitOtpClickGACallback:$=()=>null,otpScreenOnLoadCSCallback:x=()=>null,otpScreenOnLoadGACallback:U=()=>null,requestNewOtpClickCSCallback:j=()=>null,requestNewOtpClickGACallback:F=()=>null,deviceExhaustedAnalytics:B=()=>null}=e;const{isOnline:q}=(0,O.useOnline)(),[V,H]=(0,r.useState)(null),[W,Y]=(0,r.useState)(""),[K,J]=(0,r.useState)("sent"),[X,z]=(0,r.useState)(""),[Q,Z]=(0,r.useState)(!1),[ee,te]=(0,r.useState)(!1),[ne,ae]=(0,r.useState)(!1),[oe,le]=(0,r.useState)(!1),[re,ie]=(0,r.useState)(A),[se,ce]=(0,r.useState)(null),ue=(0,_.getCountryCode)(n),de=a?"submit_mobile_otp":"submit_email_otp";(0,r.useEffect)((()=>{const e=(0,_.getDomainFromSubDomainURL)(),t=(0,_.getChromeVersion)(),{otpReferenceId:n=""}=h||{},{otpReferenceIdFromWeb:a=""}=D||{};t>77&&t<82&&(0,_.addMetaTag)("http-equiv","origin-trial",{content:C.SMS_RECEIVER_API_CHROME_ORIGIN_TRIAL_META_CONTENT[e]}),a||n||Ce(),U&&U(E.otpPageViewGAData)}),[]),(0,r.useEffect)((()=>{q&&6===W.length&&_e()}),[W]);const pe=()=>{V&&V.abort&&V.abort()},ge=async()=>{if("sms"in navigator)try{pe(),H(new AbortController);const e=(await navigator.sms.receive(V)).content.match(/^[\s\S]*otp=([0-9]{6})[\s\S]*$/m)[1];if(!e)throw new Error("Received the SMS, but failed to retrieve the OTP.");Y(e)}catch(e){if("AbortError"!==e.name)throw new Error("Failed to receive SMS")}},me=a?"phone":"email",fe=a?"sms":null,Ce=async()=>{const e={channel:me,subChannel:fe,details:{[me]:a||l,origin:window.location.origin}};if(q)try{const t=(0,_.getBaseUrl)(window.location.hostname,!1),n=await d.default.post(`${t}${C.API_END_POINTS.sendOtp}`,e,null,{"x-app-code":C.APP_CODE}),a=(0,_.getIn)(n,["resend","status"])||!1;(0,_.getIn)(n,["id"])&&a?(ce(n),await ge()):Ee(n,"send")}catch(t){throw new Error(t)}},be=async()=>{const{otpReferenceId:e="",status:t=""}=h||{},{otpReferenceIdFromWeb:n="",statusFromWeb:a=""}=D||{},o="Y"===t,l=(0,_.getIn)(se,["id"])||e||n||"",r=(0,_.getIn)(se,["resend","status"])||o||a||!1,i=(0,_.getBaseUrl)(window.location.hostname,!1);Y("");const s={experiment:"",product:"login",eventLabel:"",event:"gtmstdevent",eventAction:"click",pagetype:de,user_language:"English",eventCategory:"resend_otp_button_clicked"};if(q&&l&&r){ie(A),J("resent");try{const e={id:l,channel:me,subChannel:fe},t=await d.default.post(`${i}${C.API_END_POINTS.resendOtp}`,e),n=(0,_.getIn)(t,["resend","status"])||!1,a=(0,_.getIn)(t,["message"])||"";E.resendOtpClickGAData.error_message=a,G&&G(s),ce(t),await ge(),n||Ee(t,"resend")}catch(c){throw new Error(c)}}},_e=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(e&&e.preventDefault(),!Q&&6===W.length){ie(A);try{te(!0),"recoverAccount"===N?await(async()=>{if(k){const e=(0,_.getIn)(se,["id"])||"",t=(0,_.getBaseUrl)(window.location.hostname),n={otpReferenceId:e,otp:W,identifier:k},a=await d.default.post(`${t}${C.API_END_POINTS.recoverEmailAccount}`,n);200===(0,_.getIn)(a,["statusCode"])?R((0,b.formatLoginResponse)(a)):Ee(a,"login")}})():"updateNumber"===N||"verifyNumber"===N?"web"!==i?await(async()=>{const{otpReferenceId:e="",MEMBERID:n="",LSID:a=""}=h||{},o=(0,_.getIn)(se,["id"])||e||"",l=(0,_.getBaseUrl)(window.location.hostname,!1),r={otpReferenceId:o,otp:W,channel:"phone"},i={"x-access-token":a,"x-platform":C.APP_CODE,"x-app-version":C.APP_VERSION};let s,c={},u=!1;s=await d.default.post(`${l}${C.API_END_POINTS.members}/${n}/set-pii`,r,null,i),(0,_.getIn)(s,["id"])&&(c=t?{status:"AUTHENTICATION_SUCCESSFUL",state:s}:{status:"PARTIALLY_AUTHENTICATED",state:(0,_.getIn)(s,["legacy","id"])||"",code:`${o}&${W}`,response:JSON.stringify(s)},u=!0),u?R(c):Ee(s,"login")})():await(async()=>{const{MEMBERID:e="",LSID:t=""}=S||{},{otpReferenceIdFromWeb:n=""}=D||{},a=(0,_.getIn)(se,["id"])||n||"",o=(0,_.getBaseUrl)(window.location.hostname,!1),l={"x-access-token":t,"x-platform":C.APP_CODE,"x-app-version":C.APP_VERSION},r={otpReferenceId:a,otp:W,channel:me},i=await d.default.post(`${o}${C.API_END_POINTS.members}/${e}/set-pii`,r,null,l),s=(0,_.getIn)(i,["message"])||"";E.submitOtpClickGAData.error_message=s,$&&$(E.submitOtpClickGAData),200===(0,_.getIn)(i,["statusCode"])?R((0,b.updatePIIDetails)(i,S)):Ee(i,"login")})():"web"!==i?await(async()=>{const e=(0,_.getIn)(se,["id"])||"",n=(0,_.getBaseUrl)(window.location.hostname),a={mode:"otp",channel:"phone",details:{otp:W,otpReferenceId:e}};let o,l={},r=!1;o=await d.default.post(`${n}${C.API_END_POINTS.login}`,a),(0,_.getIn)(o,["id"])&&(l=t?{status:"AUTHENTICATION_SUCCESSFUL",state:o}:{status:"PARTIALLY_AUTHENTICATED",state:(0,_.getIn)(o,["legacy","id"])||"",code:`${e}&${W}`,response:JSON.stringify(o)},r=!0),r?R(l):Ee(o,"login")})():await(async()=>{const e=(0,_.getIn)(se,["id"])||"",t=(0,_.getBaseUrl)(window.location.hostname,!1),{browserName:n,majorVersion:a}=(0,_.getBrowserDetails)(),o={experiment:"",product:"login",event:"gtmstdevent",eventAction:"click",pagetype:de,user_language:"English",eventCategory:"submit_otp_button_clicked"},l={mode:"otp",channel:me,details:{otp:W,otpReferenceId:e}},r=(0,_.isDeviceTypeMobile)()?C.APP_CODE:C.DESKTOP_APP_CODE,i={"x-app-code":r,"x-platform":r,"x-device-id":(0,_.getUniqueId)(),"x-device-name":(0,_.getOS)(),"x-user-agent":`${n} ${a}`},s=await d.default.post(`${t}${C.API_END_POINTS.login}`,l,null,i),c=(0,_.getIn)(s,["message"])||"";E.submitOtpClickGAData.eventLabel=X,E.submitOtpClickGAData.error_message=c,$&&$(o),(0,_.getIn)(s,["id"])?R((0,b.formatLoginResponse)(s)):Ee(s,"login")})(),te(!1)}catch(n){throw te(!1),new Error(n)}}},Ee=(e,t)=>{if(e&&e.statusCode){let n=!1,a=!1;"login"!==t&&"verify"!==t||(498===e.statusCode?n=!0:410===e.statusCode?(n=!0,a=!0,Z(!0)):400===e.statusCode?(Y(""),ae(!0),n=!0,Z(!0)):419===e.statusCode?(n=!0,a=!0,Z(!0)):500===e.statusCode?n=!0:429===e.statusCode?(n=!0,a=!0):422===e.statusCode&&(a=!0,Z(!0),le(!0))),"resend"===t&&(429===e.statusCode?(a=!0,n=!0):410===e.statusCode?(n=!0,a=!0,Z(!0)):500===e.statusCode?n=!0:400===e.statusCode&&(Y(""),ae(!0),n=!0,Z(!0))),"send"===t&&(400===e.statusCode?(Y(""),ae(!0),n=!0,Z(!0)):500===e.statusCode&&(n=!0));const o=w(w({},e),{},{inputFieldError:n,bottomSheetError:a,api:t});ie(o)}else ie({message:"Something went wrong. Please try again.",inputFieldError:!0})},Oe=()=>{E.requestNewOtpClickGAData.error_message=(0,_.getIn)(re,["message"])||"",F&&F(E.requestNewOtpClickGAData),Y(""),ie(A),Z(!1),Ce()},ve=W?W.split("").filter((e=>e.trim())).length:0,{message:Ie="",subMessage:we="",inputFieldError:Ae=!1}=re||{};return r.default.createElement(c.ModalWrapper,{isDesktop:y,vh:I},i&&"web"===i&&r.default.createElement(c.LoginModalHeader,null,r.default.createElement(c.ModalHeaderIcon,null,r.default.createElement(c.HeaderIcon,{onClick:()=>{pe(),T(!1)}},r.default.createElement(s.default,null))),r.default.createElement(c.ModalHeaderIcon,null)),r.default.createElement(c.ModalContent,{vh:I,source:i},r.default.createElement(c.StyledForm,{onSubmit:_e},r.default.createElement(c.FormWrapper,{source:i},r.default.createElement(c.Title,null,a?C.VERIFY_MOBILE_NUMBER_TEXT:C.VERIFY_EMAIL_ADDRESS_TEXT),r.default.createElement(c.OTPSubHeader,null,"Enter OTP ",K," to"," ",r.default.createElement(c.OTPSubHeaderMobile,{bold:!0},a?`${ue} ${a}`:l)),r.default.createElement(g.default,{value:W,isPinkified:P,source:i,onChange:Y,autoFocus:!ne||null,disabled:!!ne}),re&&Ae&&r.default.createElement(c.OTPErrorWrapper,null,r.default.createElement(c.InputErrorText,null,Ie))),r.default.createElement(c.LoginBottomWrapper,null,(()=>{const{bottomSheetError:e,statusCode:t,api:n}=re,{otpReferenceId:a="",timeout:l=""}=h||{},{otpReferenceIdFromWeb:i="",timeoutFromWeb:s=""}=D||{};return"login"===n&&498!==t&&e||"resend"===n||"verify"===n?r.default.createElement(p.default,(0,o.default)({},re,{requestOtpClick:Oe,isPinkified:P})):se&&!ee&&se.id&&se.resend&&se.resend.status&&400!==se.statusCode&&400!==re.statusCode||a||i?r.default.createElement(m.default,{isOnline:q,isPinkified:P,updateCount:z,onResendClick:be,retryTimeout:(0,_.getIn)(se,["resend","timeout"])||parseInt(l)||s}):r.default.createElement("div",{style:{minHeight:16}})})(),r.default.createElement(c.ConfirmButton,{isDesktop:y,isClickable:6===ve&&q&&!Q,onKeyPress:_e,isPinkified:P},ee?r.default.createElement(u.default,null):"Continue")))),oe?r.default.createElement(f.default,{message:Ie,subMessage:we,close:()=>{le(!1),T(!1)},deviceExhaustedAnalytics:B}):null)};k.propTypes={verificationType:i.string,mobile:i.string.isRequired,email:i.string.isRequired,appCode:i.string.isRequired,tempUd:i.object,resendOtpClickGACallback:i.func,resendOtpClickCSCallback:i.func,submitOtpClickGACallback:i.func,submitOtpClickCSCallback:i.func,otpScreenOnLoadGACallback:i.func,otpScreenOnLoadCSCallback:i.func,requestNewOtpClickCSCallback:i.func,requestNewOtpClickGACallback:i.func,onOTPVerifiedSuccess:i.func.isRequired,deviceExhaustedAnalytics:i.func},t.default=k},70655:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.submitOtpClickGAData=t.resendOtpClickGAData=t.requestNewOtpClickGAData=t.otpPageViewGAData=t.loginPageViewGAData=t.loginButtonClickGAData=void 0,t.otpPageViewGAData={experiment:"",product:"login",event:"tvc_allpage",app_code:"mobileweb",pagetype:"submit_otp"},t.loginPageViewGAData={experiment:"",product:"login",pagetype:"login",event:"tvc_allpage",app_code:"mobileweb",event_type:"page_view"},t.loginButtonClickGAData={experiment:"",eventLabel:"",product:"login",screenName:"login",event:"gtmstdevent",app_code:"mobileweb",eventAction:"click",user_language:"English",eventCategory:"submit_number_button_clicked"},t.requestNewOtpClickGAData={experiment:"",eventLabel:"",product:"login",event:"gtmstdevent",eventAction:"click",pagetype:"submit_otp",user_language:"English",eventCategory:"request_new_otp_button_clicked"},t.resendOtpClickGAData={experiment:"",product:"login",eventLabel:"",event:"gtmstdevent",eventAction:"click",pagetype:"submit_otp",user_language:"English",eventCategory:"resend_otp_button_clicked"},t.submitOtpClickGAData={experiment:"",product:"login",event:"gtmstdevent",eventAction:"click",pagetype:"submit_otp",user_language:"English",eventCategory:"submit_otp_button_clicked"}}}]);